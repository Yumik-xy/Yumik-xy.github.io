---
layout: post
title: åŸºäºMatlabçš„KNN+PCAè¯­éŸ³äºŒåˆ†ç±»
date: 2021-05-12 23:06:47 +0800
categories: è¯­éŸ³è¯†åˆ«
tag: MATLAB
---

* content
{:toc}
KNN+PCAå®ç°ç”µåŠ›ç³»ç»Ÿæ­£å¸¸/æ•…éšœäºŒåˆ†ç±»å¤„ç†

### PCAç®€è¦ä»‹ç»

PCAä¹Ÿç§°â€œä¸»å…ƒåˆ†æâ€ï¼Œä¸»è¦ç”¨äºæ•°æ®é™ç»´ï¼Œç±»ä¼¼**æœ€ä¼˜æœ‰æŸå‹ç¼©**æ–¹æ³•

ğŸŒ°ä¾‹å­ï¼š

å¯¹ä¸€ä¸ªäºŒç»´æ•°æ®ï¼Œæ‰¾åˆ°ä¸€æ¡ç›´çº¿ä½¿æ‰€æœ‰æ•°æ®è·ç¦»çº¿çš„è·ç¦»ä¹‹å’Œæœ€çŸ­ï¼Œè¯¥çº¿ç§°ä¸º**æœ€ä½³æŠ•å½±çº¿**ï¼Œæ­¤æ—¶è¯¥ç‚¹åˆ°åŸç‚¹è¿æˆçš„çº¿æ®µåœ¨çº¿ä¸ŠæŠ•å½±çš„è·ç¦»â€œæœ€é•¿â€ï¼ˆå³åˆ°åŸç‚¹çš„è·ç¦»ä¸€å®šï¼Œåˆ°ç›´çº¿è·ç¦»æœ€çŸ­ï¼Œå› æ­¤åœ¨ç›´çº¿ä¸Šçš„æŠ•å½±æœ€é•¿ï¼‰ï¼Œå³å¯ä»¥ä¿ç•™æœ€å¤šçš„æœ‰æ•ˆä¿¡æ¯ã€‚

<img src="https://yumik-xy.oss-cn-qingdao.aliyuncs.com/img/20210515234051.png" alt="image-20210512233141030"  />

### KNNç®€è¦ä»‹ç»

KNNç§°â€œKé‚»è¿‘ç®—æ³•â€ï¼Œä¸»è¦ç”¨äºåˆ¤æ®æ•°æ®å±äºå“ªä¸€åˆ†ç±»

ğŸŒ°ä¾‹å­ï¼š

 å¯¹äºä¸€ç»„æ•°æ®ï¼Œç°å°†å…¶åˆ†æˆAã€Bä¸¤ç»„ã€‚ç°åœ¨æœ‰ä¸€æœªçŸ¥èŠ‚ç‚¹ï¼Œä¸ºå¯»æ‰¾å…¶ç»„åˆ«ï¼Œç®—æ³•ä¼šå¯»æ—©å…¶è·ç¦»æœ€è¿‘çš„Kä¸ªèŠ‚ç‚¹ï¼Œè‹¥KèŠ‚ç‚¹ä¸­Aç»„èŠ‚ç‚¹æ•°>Bç»„èŠ‚ç‚¹æ•°ï¼Œåˆ™èŠ‚ç‚¹å½’ä¸ºAç»„ï¼Œåä¹‹åŒç†ã€‚

<img src="https://yumik-xy.oss-cn-qingdao.aliyuncs.com/img/20210515234059.png" alt="image-20210512233808658"  />

### è¯†åˆ«è¿‡ç¨‹

#### è¯»å…¥è®­ç»ƒé›†æ•°æ®å’Œè®­ç»ƒé›†æ ‡ç­¾

è¯»å–è®­ç»ƒç›®å½•æ‰€æœ‰çš„å£°éŸ³æ•°æ®å’Œæ ‡ç­¾ï¼Œç”±äºæä¾›çš„æ ‡ç­¾ä¸º[1,2]â€‹åˆ†å¸ƒçš„å€¼ï¼Œæ•…è¿™é‡Œå°†å…¶è½¬åŒ–ä¸ºâ€‹[-1,1]åˆ†å¸ƒä¾¿äºè¿›è¡ŒäºŒåˆ†ç±»åˆ¤å†³

```matlab
train_wav_path_list = dir(strcat(train_path,'*.wav')); % è¯»å–æ‰€æœ‰ wav æ–‡ä»¶
train_wav_length = length(train_wav_path_list); % å¤„ç†è®­ç»ƒé›†æ•°æ®
train_selection_wav = zeros(train_wav_length,171); % è®­ç»ƒé›†ä¿å­˜
train_lable = [1 1 ... 2 2 2 ... 1];
train_lable = (train_lable - 1.5)*2;
```

#### è®­ç»ƒé›†æ•°æ®è¿›è¡Œé¢„å¤„ç†

å¯¹æ‰€æœ‰çš„æ•°æ®è¿›è¡Œç‰¹å¾å€¼é€‰æ‹©ï¼Œå¹¶ä¿å­˜åœ¨é€‰æ‹©åçš„çŸ©é˜µä¸­ã€‚

```matlab
for i = 1:train_wav_length
    wav = audioread([train_path, num2str(i), '.wav'])'; % è¯»å…¥æ•°æ®
    wav = wav(1:max_audio);
    selection_wav = feature_selection(wav); % ç‰¹å¾é€‰æ‹©å‡½æ•°
    selection_wav = selection_wav'; % è½¬ç½®
    train_selection_wav(i,:) = selection_wav(:);
end
```

æ³¨æ„åˆ°å‡½æ•°`feature_selection(wav)`å³ä¸ºç‰¹å¾å€¼é€‰æ‹©å‡½æ•°ã€‚

å‡½æ•°é¦–å…ˆå¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œå½’ä¸€åŒ–æ“ä½œï¼Œå°†æ•°æ®è¿›è¡Œ0ç‚¹å¯¹é½ä½¿å¾—æ‰€æœ‰æ•°æ®å’Œä¸º0ï¼Œè¿™æ ·æ˜¯ä¸ºäº†æ›´å¥½çš„åšPCAè¿ç®—ï¼Œå½’ä¸€åŒ–å…¬å¼ä¸º

$x^*=\frac{x-\mu}{\sigma}$

å‡½æ•°å¦‚ä¸‹ï¼š

```matlab
function new_data = normalization(data) % æ•°æ®å½’ä¸€åŒ–å‡½æ•°
    data_mean = mean(data); % æ±‚å‡å€¼Î¼
    data_norm = norm(data);
    new_data = (data - data_mean) / data_norm;
end
```

è¿›è¡Œå½’ä¸€åŒ–åå°†8000bitè¯­éŸ³ä¿¡å·è¿›è¡Œåˆ†å¸§ï¼Œåˆ†å¸§æ•°é€šè¿‡å…¬å¼

$fn=\frac{N-wlen}{inc}/+1$

è¿›è¡Œè®¡ç®—ã€‚å–åˆ†å¸§é•¿åº¦ä¸º800å¸§ï¼Œå¸§ç§»ä¸º400ï¼Œè®¡ç®—å¯å¾—éœ€è¦åˆ†æˆ19å¸§ï¼Œå¸§ä¸å¸§ä¹‹é—´é€šè¿‡Hammingç è¿›è¡Œè¿æ¥ï¼Œåˆ†å¸§å‡½æ•°å¦‚ä¸‹ï¼š

```matlab
function f=enframe(data,win,inc)
    nx=length(data);
    nwin=length(win);
    if (nwin == 1)
       len = win;
    else
       len = nwin;
    end
    if (nargin < 3)
       inc = len;
    end
    nf = fix((nx-len+inc)/inc);
    f=zeros(nf,len);
    indf= inc*(0:(nf-1)).';
    inds = (1:len);
    f(:) = data(indf(:,ones(1,len))+inds(ones(nf,1),:));
    if (nwin > 1)
        w = win(:)';
        f = f .* w(ones(nf,1),:);
    end
end
```

åˆ†å¸§åçš„å³å¯¹æ¯ä¸€å¸§è¿›è¡Œç‰¹å¾å€¼é€‰æ‹©ã€‚å¯¹åˆ†å¸§åæ•°æ®è¿›è¡Œå‚…é‡Œå¶å˜æ¢ï¼Œè®¡ç®—å¾—åˆ°å­å¸¦èƒ½é‡å’Œæ€»çš„é¢‘å¸¦èƒ½é‡ä½œä¸ºè¯¥å¸§çš„ç‰¹å¾å€¼ï¼Œç”±æ­¤å¯ä»¥å¾—åˆ°9Ã—19â€‹çš„ç‰¹å¾å€¼çŸ©é˜µï¼Œç‰¹å¾å€¼é€‰æ‹©å‡½æ•°å¦‚ä¸‹ï¼š

```matlab
function selection_data = feature_selection(data) % ç‰¹å¾é€‰æ‹©å‡½æ•°
    enframe_data = enframe(data,hamming(800),400); % å£°éŸ³åˆ†æˆ19å¸§ä¿¡å·
    E = [];
    for i = 1:size(enframe_data,1)
        wav_std = normalization(enframe_data(i,:)); % æ•°æ®å½’ä¸€åŒ–
        wav_std_fft = abs(fft(wav_std,2048)); % åš2048çš„fftå˜æ¢
        % è®¡ç®—é¢‘å¸¦èƒ½é‡
        E0 = sum(wav_std_fft(1:1024).^2); % æ€»èƒ½é‡
        E1 = sum(wav_std_fft(1:120).^2); % å­å¸¦èƒ½é‡
        E2 = sum(wav_std_fft(121:250).^2); % å­å¸¦èƒ½é‡
        E3 = sum(wav_std_fft(251:360).^2); % å­å¸¦èƒ½é‡
        E4 = sum(wav_std_fft(361:480).^2); % å­å¸¦èƒ½é‡
        E5 = sum(wav_std_fft(481:600).^2); % å­å¸¦èƒ½é‡
        E6 = sum(wav_std_fft(601:730).^2); % å­å¸¦èƒ½é‡
        E7 = sum(wav_std_fft(731:850).^2); % å­å¸¦èƒ½é‡
        E8 = sum(wav_std_fft(851:1024).^2); % å­å¸¦èƒ½é‡    
        E = [E; E0 E1 E2 E3 E4 E5 E6 E7 E8];
    end
    selection_data = E;
end
```

#### è¯»å…¥æµ‹è¯•é›†æ•°æ®å’Œæµ‹è¯•é›†æ ‡ç­¾

æµ‹è¯•é›†çš„å¤„ç†æ–¹å¼ä¸è®­ç»ƒé›†å®Œå…¨ä¸€è‡´ï¼Œè¿™é‡Œä¸å†è¿‡å¤šèµ˜è¿°ã€‚

è‹¥è®­ç»ƒé›†æˆ–æµ‹è¯•é›†è¾ƒå¤§ï¼Œå¯ä»¥å°†é¢„å…ˆæå–å¾—åˆ°çš„ç‰¹å¾å€¼å˜é‡å†™å…¥ä¸º*.mat*æ–‡ä»¶è¿›è¡Œä¿å­˜ï¼Œæ–¹ä¾¿åæœŸè°ƒç”¨ã€‚

#### è®¡ç®—ç‰¹å¾å€¼çš„ç‰¹å¾å‘é‡

å¾—åˆ°è®­ç»ƒé›†çš„ç‰¹å¾å‘é‡æ•°ç»„åï¼Œç»è¿‡PCAç®—æ³•è¿›è¡Œé™ç»´ï¼Œå°†9ç»´æ•°æ®é™æˆ1ç»´æ•°æ®ï¼Œè®¡ç®—æ­¥éª¤å¦‚ä¸‹ï¼š

1. å¯¹åæ–¹å·®çŸ©é˜µ$\Sigma_X$å†™å‡ºè¡Œåˆ—å¼ï¼š$\|\Sigma_x-\lambda E\|$

2. ä»¤$\|\Sigma_x-\lambda E\|=0$ï¼Œå¾—åˆ°çš„$\lambda_1,\lambda_2,\cdots,\lambda_n$å°±æ˜¯åæ–¹å·®çŸ©é˜µ$\Sigma_x$çš„ç‰¹å¾å€¼

3. å°†$\lambda=\lambda_i$å¸¦å…¥ï¼Œ$\|\Sigma_x-\lambda E\|=0$ï¼Œè§£å‡ºçš„åŸºç¡€è§£ç³»å°±æ˜¯$v_1,v_2,\cdots,v_n$åæ–¹å·®çŸ©é˜µ$\Sigma_x$å°±æ˜¯è¯¥ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚

```matlab
function [principal_eigenvector, i] = principal_eigenvector(data,mu)
    [row, ~] = size(data);
    mean_data = mean(data);
    ajust_data = data - repmat(mean_data,row,1);
    ajust_data = ajust_data';
    cov_data = ajust_data*ajust_data'/(size(ajust_data,1)-1);
        
    [v, d] = eig(cov_data);
    v_sort = zeros(size(v));
    [m, n] = sort(diag(d),'descend');
    
    for i = 1:row % æŒ‰ä»å¤§åˆ°å°çš„é¡ºåºæ„å»ºdï¼Œé‡æ–°æ’åºv
        v_sort(:,i) = v(:,n(i));
    end
    
    for i = 1:row
        if sum(m(1:i))/sum(m) > mu
            break;
        end
    end
    principal_eigenvector = v_sort(:,1:i);
end
```

#### è¿›è¡ŒKNNé‚»è¿‘ç®—æ³•ï¼Œæ±‚è§£æµ‹è¯•é›†åˆ†ç±»

ç”±KNNé‚»è¿‘ç®—æ³•çš„å®šä¹‰å¯çŸ¥ï¼Œç°åœ¨éœ€è¦æ‰¾nä¸ªè·ç¦»ç›®æ ‡èŠ‚ç‚¹æœ€è¿‘çš„ç‚¹ï¼Œæ ¹æ®å…¶åŒ…å«çš„æ­£å¸¸/å¼‚å¸¸ç±»çš„æ•°é‡æ¨å¯¼å‡ºç›®æ ‡èŠ‚ç‚¹çš„ç±»å‹ã€‚

ä¸Šä¸€æ­¥æˆ‘ä»¬å…ˆæ±‚å‡ºäº†å½’ä¸€åŒ–ç›´çº¿çš„ç‰¹å¾å‘é‡ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ±‚è§£å‡ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†æ¯ä¸€ç‚¹åˆ°è¯¥å‘é‡æ–¹å‘çš„æŠ•å½±åæ ‡ï¼Œé€šè¿‡åæ ‡å€¼è®¡ç®—å‡ºå³å¯è®¡ç®—æµ‹è¯•é›†çš„æŸä¸ªç‚¹åˆ°æ‰€æœ‰è®­ç»ƒé›†ç‚¹çš„è·ç¦»ï¼Œæ‰¾å‡ºè·ç¦»æœ€å°çš„nä¸ªç‚¹ï¼Œå’Œè¿™nä¸ªç‚¹çš„æ•°æ®ç±»å‹å³å¯åˆ¤å†³è¯¥ç‚¹å±äºå“ªä¸€ç±»ã€‚

æœ¬æ¬¡å®éªŒå»knnçš„nå€¼ä¸º3ï¼Œå½“æ±‚è§£diffå¤§äº1æ—¶ï¼Œåˆ¤å†³ä¸ºå¼‚å¸¸ç±»ï¼›å°äº1æ—¶åˆ¤å†³ä¸ºæ­£å¸¸ç±»ï¼Œè¿™æ˜¯ç”±äºæˆ‘ä»¬é¢„å…ˆå¯¹æ•°æ®æ ‡ç­¾è¿›è¡Œäº†[-1,1]çš„å¤„ç†ï¼Œå³æ­£å¸¸ç”¨-1è¡¨ç¤ºï¼Œå¼‚å¸¸ç”¨1è¡¨ç¤ºï¼Œåªè¦æ±‚è§£å‡ºå‡ ä¸ªç‚¹çš„æ ‡ç­¾å’Œï¼Œå³å¯çŸ¥é“å…¶è·ç¦»å†…åŒ…å«çš„å“ªç§ç±»å‹çš„ç‚¹æ›´å¤šã€‚

```matlab
knn = 3;

[train_vector, k] = principal_eigenvector(train_selection_wav,mu(mu_i));
train_selection_mean = mean(train_selection_wav); % å½’0åŒ–è®­ç»ƒé›†
train_len = (train_selection_wav - repmat(train_selection_mean,train_wav_length,1)) * train_vector; % æ±‚è®­ç»ƒé›†çŸ¢é‡

test_selection_mean = mean(train_selection_wav);
test_len = (test_selection_wav - repmat(test_selection_mean,test_wav_length,1)) * train_vector; % æ±‚æµ‹è¯•é›†çŸ¢é‡
    
diff = zeros(test_wav_length,1); % è®¡ç®—ç¬¬kä¸ªç›®æ ‡èŠ‚ç‚¹çš„å·®å¼‚å€¼
for i = 1:test_wav_length
    test_wav = test_len(i);
    dvalue_len = abs(train_len-repmat(test_len(i),train_wav_length,1)); % è®¡ç®—è·ç¦»æœ€å°çš„å€¼
    [svalue_len,n] = sort(dvalue_len);
    for j = 1:knn
        diff(i) = diff(i) + train_lable(n(j));
    end
    if diff(i)*test_lable(i)<0
        ['ç¬¬' num2str(i) 'å‡ºç°é”™è¯¯']
    end
end
err = sum(diff.*test_lable'<0);
errP = err/test_wav_length;
out = ['å½“mu=' num2str(mu(mu_i)) 'ï¼Œk=' num2str(k) 'æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š' num2str(errP*100) '%']

```

#### å®éªŒç»“æœåˆ†æ

åˆ¤å†³ç»“æœå¦‚ä¸‹ï¼š

```matlab
out = 'å½“mu=0.5ï¼Œk=1æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=0.55ï¼Œk=1æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=0.6ï¼Œk=1æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=0.65ï¼Œk=1æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=0.7ï¼Œk=1æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=0.75ï¼Œk=2æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=0.8ï¼Œk=2æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=0.85ï¼Œk=2æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=0.9ï¼Œk=2æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=0.95ï¼Œk=7æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
out = 'å½“mu=1ï¼Œk=128æ—¶ï¼Œé”™è¯¯ç‡ä¸ºï¼š0%'
```

Î¼å’Œkçš„å…³ç³»å¦‚ä¸‹å›¾ï¼Œä¸éš¾çœ‹å‡ºå½“kå–1æ—¶ï¼ŒÎ¼å€¼å·²ç»è¾¾åˆ°0.7~0.75ä¹‹é—´ï¼Œè¿™æ˜¯ç”±äºç‰¹å¾å€¼å‘é‡ä¸­æœ‰ä¸€å‘é‡å æ¯”å¾ˆå¤§ï¼Œå…¶ä½“ç°äº†æ•°æ®çš„**ä¸»è¦åˆ¤å†³å‡†åˆ™**

<img src="https://yumik-xy.oss-cn-qingdao.aliyuncs.com/img/20210515234111.png" alt="image-20210513082417477" style="zoom:67%;" />

ä¸‹å›¾ç»™å‡ºäº†è®­ç»ƒé›†å’Œæµ‹è¯•é›†åœ¨ä¸åŒÎ¼çš„å–å€¼ä¸‹ï¼Œæ‰€å±•ç°çš„æŠ•å½±é•¿åº¦åˆ†å¸ƒå¦‚ä¸‹ï¼Œçº¢è‰²éƒ¨åˆ†ä¸ºéœ€è¦è­¦å‘Šçš„éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹å‡ºå…¶è¢«è¾ƒå¥½çš„åˆ†ç¦»å‡ºæ¥

<img src="https://yumik-xy.oss-cn-qingdao.aliyuncs.com/img/20210515234116.png" alt="image-20210513082543621" style="zoom:67%;" />

<img src="https://yumik-xy.oss-cn-qingdao.aliyuncs.com/img/20210515234559.png" alt="image-20210513082549545" style="zoom:67%;" />